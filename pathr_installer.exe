import os
import sys
import urllib.request
import shutil

def get_scripts_directory():
    # Find the location of the scripts directory for pip-installed executables
    if hasattr(sys, 'real_prefix'):  # check if in a virtual environment
        scripts_dir = os.path.join(sys.prefix, 'Scripts' if os.name == 'nt' else 'bin')
    else:
        # System-wide or user-specific Scripts directory
        scripts_dir = os.path.join(sys.exec_prefix, 'Scripts' if os.name == 'nt' else 'bin')
    return scripts_dir

def download_pathr_executable(url, dest_path):
    print(f"Downloading pathr from {url}...")
    try:
        urllib.request.urlretrieve(url, dest_path)
        print(f"Downloaded pathr to {dest_path}")
    except Exception as e:
        print(f"Error downloading pathr: {e}")
        sys.exit(1)

def install_pathr():
    # URL to the pathr executable on GitHub
    url = "https://github.com/Cygnasium/pathr/blob/main/pathr.exe?raw=true"
    
    # Determine the destination directory
    scripts_dir = get_scripts_directory()
    os.makedirs(scripts_dir, exist_ok=True)
    dest_path = os.path.join(scripts_dir, 'pathr.exe' if os.name == 'nt' else 'pathr')
    
    # Download the executable
    download_pathr_executable(url, dest_path)
    
    # Make the executable executable (for Unix-like systems)
    if os.name != 'nt':
        os.chmod(dest_path, 0o755)
    
    print(f"pathr has been installed successfully in {scripts_dir}")
    print("You can now use 'pathr' from the terminal.")

if __name__ == "__main__":
    install_pathr()
